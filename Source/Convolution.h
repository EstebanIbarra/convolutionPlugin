/*
  ==============================================================================

    Convolution.h
    Created: 7 May 2022 1:57:38pm
    Author:  eir

  ==============================================================================
*/

#pragma once
#include <JuceHeader.h>

class Convolution
{
public:
    Convolution();
    ~Convolution();
    
    /**
     Initializes Juce Convolution
     @return void
     */
    void prepare();
    
    /**
     Prepares the Class for using any internal IR
     @param juce::AudioProcessorValueTreeState &apvts
     @return void
     */
    void prepareInternalIR(juce::AudioProcessorValueTreeState &apvts);
    
    /**
     Prepares the Class for using any external IR
     @param juce::dsp::ProcessSpec &spec
     @return void
     */
    void prepareExternalIR();
    
    /**
     Prepares the Class for using any bus IR
     @param juce::AudioBuffer<float> &busBuffer
     @return void
     */
    void prepareBusIR(juce::AudioBuffer<float> &busBuffer);
    
    /**
     Prepares the Class for using any bus IR
     @param juce::dsp::ProcessSpec &spec
     @param juce::AudioProcessorValueTreeState &apvts
     @return void
     */
    void prepareManager(juce::dsp::ProcessSpec &spec, juce::AudioProcessorValueTreeState &apvts);
    
    /**
     Preprocess the Audio Buffer
     @param juce::AudioBuffer<float> &mainBuffer
     @param juce::AudioBuffer<float> &busBuffer
     @param juce::AudioProcessorValueTreeState &apvts
     @return void
     */
    void process(juce::AudioBuffer<float> &mainBuffer, juce::AudioBuffer<float> &busBuffer, juce::AudioProcessorValueTreeState &apvts);
    
private:
    juce::dsp::Convolution juceConvolution;
    juce::File impulseFile;
    juce::dsp::ProcessSpec referenceSpec;
    const char *binaryIRWav[38] {
        BinaryData::Block_Inside_wav,
        BinaryData::Bottle_Hall_wav,
        BinaryData::Cement_Blocks_1_wav,
        BinaryData::Cement_Blocks_2_wav,
        BinaryData::Chateau_de_Logne_Outside_wav,
        BinaryData::Conic_Long_Echo_Hall_wav,
        BinaryData::Deep_Space_wav,
        BinaryData::Derlon_Sanctuary_wav,
        BinaryData::Direct_Cabinet_N1_wav,
        BinaryData::Direct_Cabinet_N2_wav,
        BinaryData::Direct_Cabinet_N3_wav,
        BinaryData::Direct_Cabinet_N4_wav,
        BinaryData::Five_Columns_Long_wav,
        BinaryData::Five_Columns_wav,
        BinaryData::French_18th_Century_Salon_wav,
        BinaryData::Going_Home_wav,
        BinaryData::Greek_7_Echo_Hall_wav,
        BinaryData::Highly_Damped_Large_Room_wav,
        BinaryData::In_The_Silo_Revised_wav,
        BinaryData::In_The_Silo_wav,
        BinaryData::Large_Bottle_Hall_wav,
        BinaryData::Large_Long_Echo_Hall_wav,
        BinaryData::Large_Wide_Echo_Hall_wav,
        BinaryData::Masonic_Lodge_wav,
        BinaryData::Musikvereinsaal_wav,
        BinaryData::Narrow_Bumpy_Space_wav,
        BinaryData::Nice_Drum_Room_wav,
        BinaryData::On_a_Star_wav,
        BinaryData::Parking_Garage_wav,
        BinaryData::Rays_wav,
        BinaryData::Right_Glass_Triangle_wav,
        BinaryData::Ruby_Room_wav,
        BinaryData::Scala_Milan_Opera_Hall_wav,
        BinaryData::Small_Drum_Room_wav,
        BinaryData::Small_Prehistoric_Cave_wav,
        BinaryData::St_Nicolaes_Church_wav,
        BinaryData::Trig_Room_wav,
        BinaryData::Vocal_Duo_wav
    };
    const int binaryIRWavSize[38] {
        BinaryData::Block_Inside_wavSize,
        BinaryData::Bottle_Hall_wavSize,
        BinaryData::Cement_Blocks_1_wavSize,
        BinaryData::Cement_Blocks_2_wavSize,
        BinaryData::Chateau_de_Logne_Outside_wavSize,
        BinaryData::Conic_Long_Echo_Hall_wavSize,
        BinaryData::Deep_Space_wavSize,
        BinaryData::Derlon_Sanctuary_wavSize,
        BinaryData::Direct_Cabinet_N1_wavSize,
        BinaryData::Direct_Cabinet_N2_wavSize,
        BinaryData::Direct_Cabinet_N3_wavSize,
        BinaryData::Direct_Cabinet_N4_wavSize,
        BinaryData::Five_Columns_Long_wavSize,
        BinaryData::Five_Columns_wavSize,
        BinaryData::French_18th_Century_Salon_wavSize,
        BinaryData::Going_Home_wavSize,
        BinaryData::Greek_7_Echo_Hall_wavSize,
        BinaryData::Highly_Damped_Large_Room_wavSize,
        BinaryData::In_The_Silo_Revised_wavSize,
        BinaryData::In_The_Silo_wavSize,
        BinaryData::Large_Bottle_Hall_wavSize,
        BinaryData::Large_Long_Echo_Hall_wavSize,
        BinaryData::Large_Wide_Echo_Hall_wavSize,
        BinaryData::Masonic_Lodge_wavSize,
        BinaryData::Musikvereinsaal_wavSize,
        BinaryData::Narrow_Bumpy_Space_wavSize,
        BinaryData::Nice_Drum_Room_wavSize,
        BinaryData::On_a_Star_wavSize,
        BinaryData::Parking_Garage_wavSize,
        BinaryData::Rays_wavSize,
        BinaryData::Right_Glass_Triangle_wavSize,
        BinaryData::Ruby_Room_wavSize,
        BinaryData::Scala_Milan_Opera_Hall_wavSize,
        BinaryData::Small_Drum_Room_wavSize,
        BinaryData::Small_Prehistoric_Cave_wavSize,
        BinaryData::St_Nicolaes_Church_wavSize,
        BinaryData::Trig_Room_wavSize,
        BinaryData::Vocal_Duo_wavSize
    };
    float const testBufferData[360] {
        0.0f,
        0.0174524f,
        0.0348995f,
        0.052336f,
        0.0697565f,
        0.0871557f,
        0.104528f,
        0.121869f,
        0.139173f,
        0.156434f,
        0.173648f,
        0.190809f,
        0.207912f,
        0.224951f,
        0.241922f,
        0.258819f,
        0.275637f,
        0.292372f,
        0.309017f,
        0.325568f,
        0.34202f,
        0.358368f,
        0.374607f,
        0.390731f,
        0.406737f,
        0.422618f,
        0.438371f,
        0.45399f,
        0.469472f,
        0.48481f,
        0.5f,
        0.515038f,
        0.529919f,
        0.544639f,
        0.559193f,
        0.573576f,
        0.587785f,
        0.601815f,
        0.615661f,
        0.62932f,
        0.642788f,
        0.656059f,
        0.669131f,
        0.681998f,
        0.694658f,
        0.707107f,
        0.71934f,
        0.731354f,
        0.743145f,
        0.75471f,
        0.766044f,
        0.777146f,
        0.788011f,
        0.798636f,
        0.809017f,
        0.819152f,
        0.829038f,
        0.838671f,
        0.848048f,
        0.857167f,
        0.866025f,
        0.87462f,
        0.882948f,
        0.891007f,
        0.898794f,
        0.906308f,
        0.913545f,
        0.920505f,
        0.927184f,
        0.93358f,
        0.939693f,
        0.945519f,
        0.951057f,
        0.956305f,
        0.961262f,
        0.965926f,
        0.970296f,
        0.97437f,
        0.978148f,
        0.981627f,
        0.984808f,
        0.987688f,
        0.990268f,
        0.992546f,
        0.994522f,
        0.996195f,
        0.997564f,
        0.99863f,
        0.999391f,
        0.999848f,
        1.0f,
        0.999848f,
        0.999391f,
        0.99863f,
        0.997564f,
        0.996195f,
        0.994522f,
        0.992546f,
        0.990268f,
        0.987688f,
        0.984808f,
        0.981627f,
        0.978148f,
        0.97437f,
        0.970296f,
        0.965926f,
        0.961262f,
        0.956305f,
        0.951057f,
        0.945519f,
        0.939693f,
        0.93358f,
        0.927184f,
        0.920505f,
        0.913545f,
        0.906308f,
        0.898794f,
        0.891007f,
        0.882948f,
        0.87462f,
        0.866025f,
        0.857167f,
        0.848048f,
        0.838671f,
        0.829038f,
        0.819152f,
        0.809017f,
        0.798636f,
        0.788011f,
        0.777146f,
        0.766044f,
        0.75471f,
        0.743145f,
        0.731354f,
        0.71934f,
        0.707107f,
        0.694658f,
        0.681998f,
        0.669131f,
        0.656059f,
        0.642788f,
        0.62932f,
        0.615661f,
        0.601815f,
        0.587785f,
        0.573576f,
        0.559193f,
        0.544639f,
        0.529919f,
        0.515038f,
        0.5f,
        0.48481f,
        0.469472f,
        0.453991f,
        0.438371f,
        0.422618f,
        0.406737f,
        0.390731f,
        0.374607f,
        0.358368f,
        0.34202f,
        0.325568f,
        0.309017f,
        0.292372f,
        0.275637f,
        0.258819f,
        0.241922f,
        0.224951f,
        0.207912f,
        0.190809f,
        0.173648f,
        0.156434f,
        0.139173f,
        0.121869f,
        0.104528f,
        0.0871557f,
        0.0697565f,
        0.052336f,
        0.0348995f,
        0.0174524f,
        3.58979e-09f,
        -0.0174524f,
        -0.0348995f,
        -0.052336f,
        -0.0697565f,
        -0.0871557f,
        -0.104528f,
        -0.121869f,
        -0.139173f,
        -0.156434f,
        -0.173648f,
        -0.190809f,
        -0.207912f,
        -0.224951f,
        -0.241922f,
        -0.258819f,
        -0.275637f,
        -0.292372f,
        -0.309017f,
        -0.325568f,
        -0.34202f,
        -0.358368f,
        -0.374607f,
        -0.390731f,
        -0.406737f,
        -0.422618f,
        -0.438371f,
        -0.45399f,
        -0.469472f,
        -0.48481f,
        -0.5f,
        -0.515038f,
        -0.529919f,
        -0.544639f,
        -0.559193f,
        -0.573576f,
        -0.587785f,
        -0.601815f,
        -0.615661f,
        -0.62932f,
        -0.642788f,
        -0.656059f,
        -0.669131f,
        -0.681998f,
        -0.694658f,
        -0.707107f,
        -0.71934f,
        -0.731354f,
        -0.743145f,
        -0.75471f,
        -0.766044f,
        -0.777146f,
        -0.788011f,
        -0.798636f,
        -0.809017f,
        -0.819152f,
        -0.829038f,
        -0.838671f,
        -0.848048f,
        -0.857167f,
        -0.866025f,
        -0.87462f,
        -0.882948f,
        -0.891007f,
        -0.898794f,
        -0.906308f,
        -0.913545f,
        -0.920505f,
        -0.927184f,
        -0.93358f,
        -0.939693f,
        -0.945519f,
        -0.951057f,
        -0.956305f,
        -0.961262f,
        -0.965926f,
        -0.970296f,
        -0.97437f,
        -0.978148f,
        -0.981627f,
        -0.984808f,
        -0.987688f,
        -0.990268f,
        -0.992546f,
        -0.994522f,
        -0.996195f,
        -0.997564f,
        -0.99863f,
        -0.999391f,
        -0.999848f,
        -1.0f,
        -0.999848f,
        -0.999391f,
        -0.99863f,
        -0.997564f,
        -0.996195f,
        -0.994522f,
        -0.992546f,
        -0.990268f,
        -0.987688f,
        -0.984808f,
        -0.981627f,
        -0.978148f,
        -0.97437f,
        -0.970296f,
        -0.965926f,
        -0.961262f,
        -0.956305f,
        -0.951057f,
        -0.945519f,
        -0.939693f,
        -0.93358f,
        -0.927184f,
        -0.920505f,
        -0.913545f,
        -0.906308f,
        -0.898794f,
        -0.891007f,
        -0.882948f,
        -0.87462f,
        -0.866025f,
        -0.857167f,
        -0.848048f,
        -0.838671f,
        -0.829038f,
        -0.819152f,
        -0.809017f,
        -0.798636f,
        -0.788011f,
        -0.777146f,
        -0.766044f,
        -0.75471f,
        -0.743145f,
        -0.731354f,
        -0.71934f,
        -0.707107f,
        -0.694658f,
        -0.681998f,
        -0.669131f,
        -0.656059f,
        -0.642788f,
        -0.62932f,
        -0.615661f,
        -0.601815f,
        -0.587785f,
        -0.573576f,
        -0.559193f,
        -0.544639f,
        -0.529919f,
        -0.515038f,
        -0.5f,
        -0.48481f,
        -0.469472f,
        -0.453991f,
        -0.438371f,
        -0.422618f,
        -0.406737f,
        -0.390731f,
        -0.374607f,
        -0.358368f,
        -0.34202f,
        -0.325568f,
        -0.309017f,
        -0.292372f,
        -0.275637f,
        -0.258819f,
        -0.241922f,
        -0.224951f,
        -0.207912f,
        -0.190809f,
        -0.173648f,
        -0.156434f,
        -0.139173f,
        -0.121869f,
        -0.104528f,
        -0.0871557f,
        -0.0697565f,
        -0.052336f,
        -0.0348995f,
        -0.0174524f
    };
    juce::AudioBuffer<float> test1;
};
